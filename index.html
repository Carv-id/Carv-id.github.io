<script>
    const isOpenForm = true; // Set to true to bypass the address check

    async function checkRoninOwnership(walletAddress) {
        try {
            const apiUrl = `https://deep-index.moralis.io/api/v2/${walletAddress}/nft/${roninContractAddress}?chain=ronin`;
            const response = await axios.get(apiUrl, {
                headers: { 'X-API-Key': MORALIS_API_KEY }
            });
            const nfts = response.data.result;
            return nfts.some((nft) => nft.token_id === roninTokenId);
        } catch (error) {
            console.error('Error checking Ronin NFT ownership:', error);
            return false;
        }
    }

    async function checkPolygonOwnership(walletAddress) {
        try {
            const contract = new web3.eth.Contract(nftABI, polygonNFTContractAddress);
            for (let tokenId of polygonTokenIds) {
                const balance = await contract.methods.balanceOf(walletAddress, tokenId).call();
                if (parseInt(balance) > 0) {
                    return true;
                }
            }
            return false;
        } catch (error) {
            console.error('Error checking Polygon NFT ownership:', error);
            return false;
        }
    }

    document.getElementById('verifyForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        if (isOpenForm) {
            Swal.fire({
                title: 'Form Ditutup',
                text: 'Turnamen saat ini telah berakhir, silakan tunggu turnamen berikutnya.',
                icon: 'info'
            });
            return;
        }

        const walletAddress = document.getElementById('walletAddress').value;

        if (!web3.utils.isAddress(walletAddress)) {
            Swal.fire({ icon: 'error', title: 'Invalid Address', text: 'Please enter a valid wallet address!' });
            return;
        }

        try {
            const ownsRoninNFT = await checkRoninOwnership(walletAddress);
            const ownsPolygonNFT = await checkPolygonOwnership(walletAddress);

            if (ownsRoninNFT || ownsPolygonNFT) {
                Swal.fire({ title: 'Success!', text: 'You are eligible for the tournament.', icon: 'success' })
                    .then(() => { document.getElementById('formSection').style.display = 'block'; document.getElementById('verifyForm').style.display = 'none'; });
            } else {
                Swal.fire({ icon: 'error', title: 'Not Eligible', text: 'Sorry, you cannot participate in the tournament.' });
            }
        } catch (error) {
            console.error('Error during ownership check:', error);
            Swal.fire({ icon: 'error', title: 'Error', text: `An error occurred: ${error.message}` });
        }
    });

</script>
